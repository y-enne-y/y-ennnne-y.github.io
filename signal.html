<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœì  ì¶œë°œ ì‹œê°„ ì•Œë¦¬ë¯¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 1rem;
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }
        .box {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
            text-align: left;
        }
        .info-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
        }
        .info-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #555;
        }
        .info-content .highlight {
            font-weight: bold;
            color: #007bff;
        }
        .error-message {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš‡ ìµœì  ì¶œë°œ ì‹œê°„ ì•Œë¦¬ë¯¸ ğŸšŒ</h1>

        <div class="box" id="result-box">
            <div class="info-title">ìµœì  ê²½ë¡œ ì •ë³´</div>
            <div class="info-content" id="result-content">ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>

    </div>

    <script>
        // =================================================================
        //                        âš ï¸ ì„¤ì • ê°’ (ì‚¬ìš©ì ì§ì ‘ ì…ë ¥)
        // =================================================================

        // 1. ì„œìš¸ ì—´ë¦°ë°ì´í„°ê´‘ì¥ì—ì„œ ë°œê¸‰ë°›ì€ ë³¸ì¸ì˜ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        // ì§€í•˜ì² ê³¼ ë²„ìŠ¤ API í‚¤ê°€ ë™ì¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        const API_KEY = 'ì—¬ê¸°ì— ë³¸ì¸ì˜ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”';

        // 2. ì§€í•˜ì²  ì—­/ë²„ìŠ¤ ì •ë¥˜ì†Œ ID (ì•„ë˜ 'ID ì°¾ëŠ” ë²•' ì°¸ê³ )
        const SUBWAY_STATION_NAME = 'ì‹ ë¦¼'; // 2í˜¸ì„  ì‹ ë¦¼ì—­
        const BUS_ARS_ID = '13145';      // ì‹ ì´Œì—­2í˜¸ì„ ì¤‘ì•™ì°¨ë¡œ ì •ë¥˜ì¥ ARS ID

        // 3. í‰ê·  ì†Œìš” ì‹œê°„ (ë‹¨ìœ„: ë¶„) - ë³¸ì¸ì—ê²Œ ë§ê²Œ ì¡°ì •í•˜ì„¸ìš”.
        const TIME_HOME_TO_SUBWAY = 10;      // ì§‘ -> ì‹ ë¦¼ì—­ê¹Œì§€ ë„ë³´ ì‹œê°„
        const TIME_SUBWAY_RIDE = 22;         // ì‹ ë¦¼ì—­ -> ì‹ ì´Œì—­ ì§€í•˜ì²  ì†Œìš” ì‹œê°„
        const TIME_SUBWAY_TO_BUS = 5;        // ì‹ ì´Œì—­ í•˜ì°¨ -> ë²„ìŠ¤ ì •ë¥˜ì¥ê¹Œì§€ í™˜ìŠ¹ ì‹œê°„

        // =================================================================

        const resultBox = document.getElementById('result-box');
        const resultContent = document.getElementById('result-content');

        // CORS ì˜¤ë¥˜ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•œ í”„ë¡ì‹œ ì„œë²„ URL
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';

        // ì§€í•˜ì²  ì‹¤ì‹œê°„ ë„ì°© ì •ë³´ API URL (ì—­ ì´ë¦„ìœ¼ë¡œ ì¡°íšŒ)
        const subwayUrl = `http://swopenAPI.seoul.go.kr/api/subway/${API_KEY}/json/realtimeStationArrival/0/10/${encodeURIComponent(SUBWAY_STATION_NAME)}`;

        // ë²„ìŠ¤ ì‹¤ì‹œê°„ ë„ì°© ì •ë³´ API URL (ì •ë¥˜ì†Œ ARS IDë¡œ ì¡°íšŒ)
        const busUrl = `http://ws.bus.go.kr/api/rest/stationinfo/getStationByUid?serviceKey=${API_KEY}&arsId=${BUS_ARS_ID}&resultType=json`;

        async function fetchDepartureInfo() {
            try {
                // 1. API ë³‘ë ¬ í˜¸ì¶œ (ì§€í•˜ì² , ë²„ìŠ¤ ì •ë³´ ë™ì‹œì— ìš”ì²­)
                const [subwayRes, busRes] = await Promise.all([
                    fetch(proxyUrl + subwayUrl),
                    fetch(proxyUrl + busUrl)
                ]);

                if (!subwayRes.ok || !busRes.ok) {
                    throw new Error('API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }

                const subwayJson = await subwayRes.json();
                const busJson = await busRes.json();

                // 2. ë°ì´í„° íŒŒì‹± ë° ê°€ê³µ
                const nextSubway = parseSubwayData(subwayJson);
                const targetBuses = parseBusData(busJson);

                if (!nextSubway) {
                    throw new Error('í˜„ì¬ ìš´í–‰ ì¤‘ì¸ ì‹ ì´Œ ë°©ë©´ ì§€í•˜ì² ì´ ì—†ìŠµë‹ˆë‹¤.');
                }
                if (targetBuses.length === 0) {
                    throw new Error('ìš´í–‰ ì¤‘ì¸ ì„œëŒ€ë¬¸03/04 ë²„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                // 3. ìµœì  ì¶œë°œ ì‹œê°„ ê³„ì‚°
                const result = calculateOptimalDeparture(nextSubway, targetBuses);
                
                // 4. ê²°ê³¼ ì¶œë ¥
                displayResult(result);

            } catch (err) {
                console.error("Error:", err);
                resultContent.innerHTML = `<div class="error-message">ğŸš« ${err.message}</div><p style="font-size:0.9rem; color:#666; margin-top:10px;">CORS ì˜¤ë¥˜ì¼ ê²½ìš°, <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">ì—¬ê¸°</a>ë¥¼ ë°©ë¬¸í•˜ì—¬ ì„ì‹œ ì•¡ì„¸ìŠ¤ë¥¼ í™œì„±í™”í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
            }
        }

        function parseSubwayData(data) {
            if (!data.realtimeArrivalList) return null;

            // 2í˜¸ì„  ë‚´ì„ ìˆœí™˜(ì‹ ì´Œ ë°©í–¥) ì—´ì°¨ë§Œ í•„í„°ë§
            const upcomingTrain = data.realtimeArrivalList.find(train => 
                train.subwayId === '1002' && train.updnLine.includes('ë‚´ì„ ')
            );
            
            if (!upcomingTrain) return null;

            return {
                arrivalMsg: upcomingTrain.arvlMsg2, // "ì „ì—­ ë„ì°©", "3ë¶„ í›„" ë“±
                remainingTime: parseInt(upcomingTrain.barvlDt) // ë„ì°©ê¹Œì§€ ë‚¨ì€ ì‹œê°„(ì´ˆ)
            };
        }

        function parseBusData(data) {
            if (!data.msgBody || !data.msgBody.itemList) return [];
            
            // ì„œëŒ€ë¬¸03, ì„œëŒ€ë¬¸04 ë²„ìŠ¤ë§Œ í•„í„°ë§
            return data.msgBody.itemList
                .filter(bus => bus.rtNm === 'ì„œëŒ€ë¬¸03' || bus.rtNm === 'ì„œëŒ€ë¬¸04')
                .map(bus => ({
                    busName: bus.rtNm,
                    remainingTime: parseInt(bus.traTime1) // ì²« ë²ˆì§¸ ë²„ìŠ¤ ë„ì°©ê¹Œì§€ ë‚¨ì€ ì‹œê°„(ì´ˆ)
                }))
                .sort((a, b) => a.remainingTime - b.remainingTime); // ê°€ì¥ ë¹¨ë¦¬ ì˜¤ëŠ” ìˆœìœ¼ë¡œ ì •ë ¬
        }

        function calculateOptimalDeparture(subway, buses) {
            const now = new Date();

            // í˜„ì¬ íƒˆ ìˆ˜ ìˆëŠ” ê°€ì¥ ë¹ ë¥¸ ì§€í•˜ì² ì´ ì‹ ë¦¼ì—­ì— ë„ì°©í•  ì‹œê°„
            const subwayArrivalTime = new Date(now.getTime() + subway.remainingTime * 1000);
